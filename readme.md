# LiteTorrent
Торрент-клиент

## Требования
  - .NET 7

## Структура
  - LiteTorrent.Core
    - Инфраструктурный код
  - LiteTorrent.Domain
    - Доменные классы
      - MerkelTree
      - Piece
      - Hash
      - SharedFile (некоторая мета-информация про скачиваемый/распространяемый файл, образ торрент-файла в клиенте)
      - ...
  - LiteTorrent.Domain.Services
    - LocalStorage
      - Репозитории для работы с MerkleTree, SharedFile, Piece
    - PieceExchange
      - Реализация протокола передачи кусков файлов
      - `PieceExchanger` содержит основные методы, которые запускают раздачу/скачивание
  - LiteTorrent.Backend
    - Сервисы для раздачи и скачивания файлов
    - HTTP API для управления этими сервисами
  - LiteTorrent.Client.Cli
    - Консольная утилита, которая обменивается данными с LiteTorrent.Backend по HTTP через loopback (localhost)


## Детали внутреннего устройства
### Протокол
  - Нет HAVE, поэтому при обмене кусками маска файла с разрающего клиента не меняется.
  - Используется дерево Мёркла для проверки целостности передаваемых кусков
  - С каждым куском передаётся полный путь подтверждения
  - Нужные куски запрашиваются по очереди (без учёта редкости)



## Конфигурация
  - Запустить скрипт `configure.py` и указать:
    - Порт, по которому CLI и Backend будут общаться
    - PieceDirectory (абсолютный путь, здесь хранятся раздаваемые/скачиваемые файлы)
    - SharedFileDirectory (абсолютный путь, любая пустая папка, в ней будут храниться образы торрент-файлов)
    - HashTreeDirectory (абсолютный путь, директория для хранения деревьев Мёркла, обязательно должна быть не равна `SharedFileDirectory`)
    - Distributing Address - адрес раздачи

## Использование (CLI)

### Запуск Backend-а
**Перед использованием CLI** нужно запустить Backend `start-backend.py`

### Команда 'help'
`litetorrent help`

### Добавление файла к раздаче
Есть два способа:
  - Добавить существующий торрент-файл
    - `litetorrent add ~/film.lt`
    - Файл сразу добавляется к раздаче (но не скачивается, скачивание нужно запустить отдельно)
  - Создать торрент файл
    - `litetorrent create film.mp4 ~/film.lt`
    - `film.mp4` должен лежать в `PieceDirectory`
    - `~/film.lt` - output path (обязательно абсолютный)
    - Сразу добавляется к раздаче файл, по которому был создан торрент-файл (`film.mp4`)

### Скачивание файла
  - Перед тем как начать скачивать файл, нужно добавить его к раздаче
  - Командой `litetorrent show` получаем список всех файлов в раздаче
  - Копируем хэш файла, который хотим загрузить.
  - Запускаем скачивание `litetorrent download <HASH_BASE32> 90.1.0.1:8000 90.1.0.2:9000`
  - `90.1.0.1:8000 90.1.0.2:9000` - адреса, с которых клиент попытается загрузить файл
  - Файл скачивается в `PieceDirectory`

### Полная остановка скачивания
  - Клиент опросит все адреса из команды `download` и остановит загрузку
  - При перезапуске Backend-а скачивание всех файлов останавливается


## Ограничения
  - Нельзя обмениваться файлами размером не более 32 байта.
  - Если файл скачивается, то он не раздаётся.
  - Одновременно может скачиваться не более одного файла.


## TODO:
  - Использовать трекер для получения адресов пиров: https://github.com/AlexMoshkov/litetorrent-tracker
